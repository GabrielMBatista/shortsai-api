generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                      String           @id @default(uuid())
  email                   String           @unique
  name                    String?
  avatar_url              String?
  google_id               String?          @unique
  subscription_plan       SubscriptionPlan @default(FREE)
  stripe_customer_id      String?
  created_at              DateTime         @default(now())
  tier                    Tier             @default(free)
  updated_at              DateTime         @default(now()) @updatedAt
  emailVerified           DateTime?        @map("email_verified")
  image                   String?
  is_blocked              Boolean          @default(false)
  role                    Role             @default(USER)
  last_video_generated_at DateTime?
  plan_id                 String?
  accounts                Account[]
  api_keys                ApiKey?
  characters              Character[]
  folders                 Folder[]
  projects                Project[]
  sessions                Session[]
  shows                   Show[]
  social_posts            SocialPost[]
  usage_logs              UsageLog[]
  user_limits             UserLimits?
  videoTransferJobs       VideoTransferJob[]
  channels                Channel[]
  personasCreated         Persona[]        @relation("PersonaCreator")
  personasOwned           Persona[]        @relation("PersonaOwner")
  personaHistory          PersonaHistory[]
  personaUsageLogs        PersonaUsageLog[]
  personaChats            PersonaChat[]
  youtubeImportBatches    YoutubeImportBatch[]
  plan                    Plan?            @relation(fields: [plan_id], references: [id])

  @@map("users")
}

model Plan {
  id                   String   @id @default(uuid())
  name                 String   @unique
  slug                 String   @unique
  description          String?
  price                Decimal  @default(0)
  monthly_images_limit Int      @default(10)
  monthly_videos_limit Int      @default(5)
  monthly_minutes_tts  Int      @default(10)
  daily_requests_limit Int      @default(50)
  daily_videos_limit   Int      @default(2)
  features             Json?
  created_at           DateTime @default(now())
  updated_at           DateTime @updatedAt
  users                User[]

  @@map("plans")
}

model Account {
  id                String   @id @default(uuid())
  userId            String   @map("user_id")
  type              String
  provider          String
  providerAccountId String   @map("provider_account_id")
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  
  // Google Drive Sync State
  drivePageToken         String?
  driveChannelId         String?
  driveChannelResourceId String?
  driveChannelExpiration DateTime?

  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  channels          Channel[]

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(uuid())
  sessionToken String   @unique @map("session_token")
  userId       String   @map("user_id")
  expires      DateTime
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

model ApiKey {
  user_id        String   @id
  gemini_key     String?
  elevenlabs_key String?
  suno_key       String?
  updated_at     DateTime @default(now()) @updatedAt
  groq_key       String?
  user           User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("api_keys")
}

model Show {
  id                   String      @id @default(uuid())
  user_id              String
  name                 String
  description          String?
  style_preset         String?
  visual_prompt        String?
  default_tts_provider TTSProvider @default(gemini)
  created_at           DateTime    @default(now())
  updated_at           DateTime    @updatedAt
  characters           Character[]
  episodes             Project[]
  user                 User        @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@map("shows")
}

model Project {
  id                            String              @id @default(uuid())
  user_id                       String
  topic                         String
  style                         String
  language                      String              @default("en")
  voice_name                    String
  tts_provider                  TTSProvider
  reference_image_url           String?
  include_music                 Boolean             @default(false)
  bg_music_prompt               String?
  bg_music_url                  String?
  bg_music_status               MusicStatus?
  created_at                    DateTime            @default(now())
  updated_at                    DateTime            @default(now()) @updatedAt
  generated_description         String?
  generated_title               String?
  generated_shorts_hashtags     String[]            @default([])
  generated_tiktok_text         String?
  generated_tiktok_hashtags     String[]            @default([])
  script_metadata               Json?
  reference_characters_snapshot Json?
  status                        ProjectStatus       @default(draft)
  duration_config               Json?
  lock_expires_at               DateTime?
  lock_session_id               String?
  video_model                   String              @default("veo")
  folder_id                     String?
  is_archived                   Boolean             @default(false)
  tags                          String[]            @default([])
  audio_model                   String?
  episode_number                Int?
  show_id                       String?
  final_video_url               String?
  channel_id                    String?
  persona_id                    String?
  persona_version               Int?
  asset_reuse_strategy          String              @default("auto_reuse")
  ProjectCharacters             ProjectCharacters[]
  folder                        Folder?             @relation(fields: [folder_id], references: [id], onDelete: Cascade)
  show                          Show?               @relation(fields: [show_id], references: [id])
  user                          User                @relation(fields: [user_id], references: [id], onDelete: Cascade)
  channel                       Channel?            @relation(fields: [channel_id], references: [id], onDelete: SetNull)
  persona                       Persona?            @relation(fields: [persona_id], references: [id], onDelete: SetNull)
  scenes                        Scene[]
  social_posts                  SocialPost[]
  usage_logs                    UsageLog[]
  personaUsageLogs              PersonaUsageLog[]

  @@index([user_id])
  @@index([show_id])
  @@index([channel_id])
  @@index([persona_id])
  @@map("projects")
}

model Folder {
  id         String    @id @default(uuid())
  name       String
  user_id    String
  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt
  parent_id  String?
  channel_id String?   @map("channel_id")
  
  parent     Folder?   @relation("SubFolders", fields: [parent_id], references: [id], onDelete: Cascade)
  children   Folder[]  @relation("SubFolders")
  user       User      @relation(fields: [user_id], references: [id], onDelete: Cascade)
  channel    Channel?  @relation(fields: [channel_id], references: [id], onDelete: Cascade)
  projects   Project[]

  @@unique([user_id, name, parent_id])
  @@index([user_id])
  @@index([user_id, channel_id])
  @@map("folders")
}

model Scene {
  id                 String      @id @default(uuid())
  project_id         String
  scene_number       Int
  visual_description String
  narration          String
  duration_seconds   Decimal     @db.Decimal(5, 2)
  image_url          String?
  image_status       SceneStatus @default(draft)
  audio_url          String?
  audio_status       SceneStatus @default(draft)
  created_at         DateTime    @default(now())
  error_message      String?
  sfx_status         SceneStatus @default(draft)
  sfx_url            String?
  audio_attempts     Int         @default(0)
  image_attempts     Int         @default(0)
  sfx_attempts       Int         @default(0)
  deleted_at         DateTime?
  word_timings       Json?
  video_status       SceneStatus @default(draft)
  video_url          String?
  video_attempts     Int         @default(0)
  media_type         String      @default("image")
  status             String      @default("DRAFT")
  version            Int         @default(0)
  visual_effect      String      @default("zoom_in")
  video_model        String?
  image_prompt_optimized String? @db.Text
  video_prompt_optimized String? @db.Text
  video_crop_config Json?
  jobs               Job[]
  project            Project     @relation(fields: [project_id], references: [id], onDelete: Cascade)
  characters         Character[] @relation("SceneToCharacter")

  @@index([project_id])
  @@index([project_id, scene_number])
  @@map("scenes")
}

model Job {
  id           String   @id @default(cuid())
  type         String
  status       String   @default("QUEUED")
  inputPayload Json
  outputResult Json?
  errorMessage String?
  projectId    String
  sceneId      String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  scene        Scene?   @relation(fields: [sceneId], references: [id])

  @@index([status])
  @@index([sceneId])
}

model UserLimits {
  user_id                  String   @id
  monthly_videos_limit     Int      @default(5)
  monthly_minutes_tts      Int      @default(10)
  monthly_images_limit     Int      @default(50)
  current_videos_used      Int      @default(0)
  current_minutes_tts_used Decimal  @default(0) @db.Decimal(10, 2)
  current_images_used      Int      @default(0)
  last_reset_date          DateTime @default(now())
  current_daily_requests   Int      @default(0)
  daily_requests_limit     Int      @default(100)
  last_daily_reset         DateTime @default(now())
  current_daily_videos     Int      @default(0)
  daily_videos_limit       Int      @default(1)
  user                     User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("user_limits")
}

model Character {
  id                String              @id @default(uuid())
  user_id           String
  name              String
  description       String?
  created_at        DateTime            @default(now())
  images            String[]
  show_id           String?
  voice_id          String?
  voice_provider    TTSProvider?
  voice_settings    Json?
  ProjectCharacters ProjectCharacters[]
  show              Show?               @relation(fields: [show_id], references: [id])
  user              User                @relation(fields: [user_id], references: [id], onDelete: Cascade)
  scenes            Scene[]             @relation("SceneToCharacter")

  @@index([user_id])
  @@map("characters")
}

model UsageLog {
  id               String         @id @default(uuid())
  user_id          String?
  project_id       String?
  action_type      UsageLogAction
  provider         String
  model_name       String
  tokens_input     Int            @default(0)
  tokens_output    Int            @default(0)
  duration_seconds Decimal        @default(0) @db.Decimal(10, 2)
  status           UsageLogStatus
  error_message    String?
  created_at       DateTime       @default(now())
  idempotency_key  String?        @unique
  project          Project?       @relation(fields: [project_id], references: [id])
  user             User?          @relation(fields: [user_id], references: [id])

  @@index([user_id])
  @@index([project_id])
  @@map("usage_logs")
}

model SocialPost {
  id            String         @id @default(uuid())
  userId        String         @map("user_id")
  projectId     String         @map("project_id")
  platform      SocialPlatform
  accountId     String?        @map("account_id")
  title         String?
  description   String?
  tags          String[]
  privacyStatus PrivacyStatus  @default(PRIVATE)
  scheduledAt   DateTime?      @map("scheduled_at")
  publishedAt   DateTime?      @map("published_at")
  status        PostStatus     @default(DRAFT)
  error         String?
  externalId    String?
  createdAt     DateTime       @default(now()) @map("created_at")
  updatedAt     DateTime       @updatedAt @map("updated_at")
  project       Project        @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("social_posts")
}

model ProjectCharacters {
  A          String
  B          String
  characters Character @relation(fields: [A], references: [id], onDelete: Cascade)
  projects   Project   @relation(fields: [B], references: [id], onDelete: Cascade)

  @@id([A, B], map: "_ProjectCharacters_AB_pkey")
  @@index([B], map: "_ProjectCharacters_B_index")
  @@map("_ProjectCharacters")
}

enum SubscriptionPlan {
  FREE
  PRO
}

enum Tier {
  free
  pro
  enterprise
}

enum TTSProvider {
  gemini
  elevenlabs
  groq
}

enum MusicStatus {
  draft
  pending
  queued
  loading
  completed
  failed
  error
}

enum SceneStatus {
  draft
  pending
  queued
  processing
  loading
  completed
  failed
  error
}

enum ProjectStatus {
  draft
  generating
  completed
  failed
  paused
}

enum UsageLogAction {
  GENERATE_SCRIPT
  GENERATE_IMAGE
  GENERATE_TTS
  GENERATE_MUSIC
  GENERATE_VIDEO
}

enum UsageLogStatus {
  success
  failed
}

enum Role {
  USER
  ADMIN
}

enum SocialPlatform {
  YOUTUBE
  TIKTOK
  INSTAGRAM
}

enum PrivacyStatus {
  PRIVATE
  UNLISTED
  PUBLIC
}

enum PostStatus {
  DRAFT
  SCHEDULED
  PUBLISHING
  PUBLISHED
  FAILED
}

model VideoTransferJob {
  id              String    @id @default(uuid())
  userId          String
  
  // Metadados do Drive (Origem)
  driveFileId     String
  driveFileName   String
  driveMimeType   String
  driveFileSize   BigInt
  driveChecksum   String?

  // Metadados do YouTube (Destino)
  youtubeVideoId  String?
  youtubeStatus   String?
  publishAt       DateTime?

  // Controle de Execução
  status          VideoTransferStatus @default(QUEUED)
  progress        Int       @default(0)
  attempts        Int       @default(0)
  lastError       String?   @db.Text
  
  // Timestamps
  createdAt       DateTime  @default(now())
  startedAt       DateTime?
  completedAt     DateTime?

  user            User      @relation(fields: [userId], references: [id])
  
  @@index([userId, status])
  @@index([driveFileId])
}

enum VideoTransferStatus {
  QUEUED
  PROCESSING
  WAITING_QUOTA
  COMPLETED
  FAILED
  SCHEDULED
}

// ═══════════════════════════════════════════════
// PERSONAS & CHANNELS SYSTEM
// ═══════════════════════════════════════════════

enum PersonaType {
  SYSTEM
  CUSTOM
}

enum PersonaVisibility {
  PUBLIC
  PRIVATE
}

enum AnalyticsPeriod {
  DAY
  WEEK
  MONTH
}

model Persona {
  id                 String             @id @default(uuid())
  type               PersonaType
  visibility         PersonaVisibility
  requiredPlan       String             @default("free") @map("required_plan")
  name               String
  description        String?
  category           String?
  isOfficial         Boolean            @default(false) @map("is_official")
  isFeatured         Boolean            @default(false) @map("is_featured")
  isPremium          Boolean            @default(false) @map("is_premium")
  systemInstruction  String             @map("system_instruction") @db.Text
  temperature        Float              @default(0.7)
  topP               Float              @default(0.9) @map("top_p")
  topK               Int                @default(40) @map("top_k")
  maxOutputTokens    Int                @default(8192) @map("max_output_tokens")
  tags               String[]           @default([])
  createdBy          String?            @map("created_by")
  ownerId            String?            @map("owner_id")
  isActive           Boolean            @default(true) @map("is_active")
  version            Int                @default(1)
  parentId           String?            @map("parent_id")
  usageCount         Int                @default(0) @map("usage_count")
  lastUsedAt         DateTime?          @map("last_used_at")
  createdAt          DateTime           @default(now()) @map("created_at")
  updatedAt          DateTime           @updatedAt @map("updated_at")
  
  creator            User?              @relation("PersonaCreator", fields: [createdBy], references: [id], onDelete: SetNull)
  owner              User?              @relation("PersonaOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  channels           Channel[]
  projects           Project[]
  versions           Persona[]          @relation("PersonaVersions")
  parent             Persona?           @relation("PersonaVersions", fields: [parentId], references: [id], onDelete: SetNull)
  history            PersonaHistory[]
  usageLogs          PersonaUsageLog[]
  chats              PersonaChat[]
  youtubeVideos      YoutubeVideo[]     @relation("YoutubeVideoPersona")
  channelPersonaHistory ChannelPersonaHistory[] @relation("ChannelPersonaHistory")
  
  @@index([type, visibility, requiredPlan])
  @@index([ownerId])
  @@index([category])
  @@index([parentId])
  @@map("personas")
}

model Channel {
  id                String             @id @default(uuid())
  userId            String             @map("user_id")
  googleAccountId   String             @map("google_account_id")
  youtubeChannelId  String             @map("youtube_channel_id")
  name              String
  description       String?
  thumbnail         String?
  personaId         String?            @map("persona_id")
  isActive          Boolean            @default(true) @map("is_active")
  autoPublish       Boolean            @default(false) @map("auto_publish")
  subscriberCount   Int?               @map("subscriber_count")
  videoCount        Int?               @map("video_count")
  viewCount         BigInt?            @map("view_count")
  lastSyncedAt      DateTime?          @map("last_synced_at")
  createdAt         DateTime           @default(now()) @map("created_at")
  updatedAt         DateTime           @updatedAt @map("updated_at")
  
  user              User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  account           Account            @relation(fields: [googleAccountId], references: [id], onDelete: Cascade)
  persona           Persona?           @relation(fields: [personaId], references: [id], onDelete: SetNull)
  projects          Project[]
  analytics         ChannelAnalytics[]
  folders           Folder[]
  youtubeVideos     YoutubeVideo[]
  importBatches     YoutubeImportBatch[]
  personaHistory    ChannelPersonaHistory[]
  
  @@unique([userId, youtubeChannelId])
  @@index([userId])
  @@index([personaId])
  @@index([googleAccountId])
  @@map("channels")
}

model PersonaHistory {
  id                String     @id @default(uuid())
  personaId         String     @map("persona_id")
  version           Int
  snapshot          Json
  changedBy         String?    @map("changed_by")
  changeReason      String?    @map("change_reason")
  performanceScore  Float?     @map("performance_score")
  createdAt         DateTime   @default(now()) @map("created_at")
  
  persona           Persona    @relation(fields: [personaId], references: [id], onDelete: Cascade)
  user              User?      @relation(fields: [changedBy], references: [id], onDelete: SetNull)
  
  @@unique([personaId, version])
  @@index([personaId])
  @@map("persona_history")
}

model ChannelAnalytics {
  id            String           @id @default(uuid())
  channelId     String           @map("channel_id")
  date          DateTime
  period        AnalyticsPeriod
  views         Int              @default(0)
  likes         Int              @default(0)
  comments      Int              @default(0)
  shares        Int              @default(0)
  subscribers   Int              @default(0)
  watchTime     Int              @default(0) @map("watch_time")
  avgRetention  Float?          @map("avg_retention")
  avgCtr        Float?           @map("avg_ctr")
  createdAt     DateTime         @default(now()) @map("created_at")
  
  channel       Channel          @relation(fields: [channelId], references: [id], onDelete: Cascade)
  
  @@unique([channelId, date, period])
  @@index([channelId, date])
  @@map("channel_analytics")
}

model PersonaUsageLog {
  id          String    @id @default(uuid())
  personaId   String    @map("persona_id")
  userId      String    @map("user_id")
  projectId   String?   @map("project_id")
  action      String
  success     Boolean
  duration    Int?
  errorMsg    String?   @map("error_msg")
  metadata    Json?
  createdAt   DateTime  @default(now()) @map("created_at")
  
  persona     Persona   @relation(fields: [personaId], references: [id], onDelete: Cascade)
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  project     Project?  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  
  @@index([personaId, createdAt])
  @@index([projectId])
  @@map("persona_usage_logs")
}

// ═══════════════════════════════════════════════
// PERSONA CHAT HISTORY SYSTEM
// ═══════════════════════════════════════════════

model PersonaChat {
  id             String            @id @default(uuid())
  personaId      String            @map("persona_id")
  userId         String            @map("user_id")
  channelId      String?           @map("channel_id")
  title          String            @default("New Chat")
  isActive       Boolean           @default(true) @map("is_active")
  lastMessageAt  DateTime          @default(now()) @map("last_message_at")
  createdAt      DateTime          @default(now()) @map("created_at")
  expiresAt      DateTime          @map("expires_at") // Auto-cleanup after 1 week
  
  persona        Persona           @relation(fields: [personaId], references: [id], onDelete: Cascade)
  user           User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  messages       PersonaChatMessage[]
  
  @@index([personaId, userId, isActive])
  @@index([userId, lastMessageAt])
  @@index([expiresAt])
  @@map("persona_chats")
}

model PersonaChatMessage {
  id        String       @id @default(uuid())
  chatId    String       @map("chat_id")
  role      String       // 'user' or 'model'
  content   String       @db.Text
  createdAt DateTime     @default(now()) @map("created_at")
  
  chat      PersonaChat  @relation(fields: [chatId], references: [id], onDelete: Cascade)
  
  @@index([chatId, createdAt])
  @@map("persona_chat_messages")
}

// ═══════════════════════════════════════════════
// YOUTUBE ANALYTICS MODULE
// ═══════════════════════════════════════════════

model YoutubeVideo {
  id              String   @id @default(uuid())
  channelId       String   @map("channel_id")
  youtubeVideoId  String   @unique @map("youtube_video_id")
  titleSnapshot   String?  @map("title_snapshot")
  durationSec     Int?     @map("duration_sec")
  publishedAt     DateTime? @map("published_at")
  
  // Persona attribution (immutable after first assignment)
  personaId       String?  @map("persona_id")
  
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")
  
  // Relations
  channel         Channel  @relation(fields: [channelId], references: [id], onDelete: Cascade)
  persona         Persona? @relation("YoutubeVideoPersona", fields: [personaId], references: [id], onDelete: SetNull)
  
  metrics         YoutubeVideoMetrics[]
  insights        YoutubeVideoInsight?
  
  @@index([channelId])
  @@index([publishedAt])
  @@index([personaId])
  @@map("youtube_videos")
}

model YoutubeVideoMetrics {
  id                   String   @id @default(uuid())
  videoId              String   @map("video_id")
  date                 DateTime
  
  // Basic metrics
  views                Int?
  watchTimeMinutes     Float?   @map("watch_time_minutes")
  avgViewDurationSec   Float?   @map("avg_view_duration_sec")
  
  // Advanced metrics
  impressions          Int?
  impressionsCtr       Float?   @map("impressions_ctr")
  likes                Int?
  comments             Int?
  
  averageViewedPercent Float?   @map("average_viewed_percent")
  trafficSource        String?  @map("traffic_source")
  deviceType           String?  @map("device_type")
  
  // Import metadata
  source               String   @default("MANUAL") // MANUAL | API
  importBatchId        String?  @map("import_batch_id")
  
  createdAt            DateTime @default(now()) @map("created_at")
  
  video                YoutubeVideo @relation(fields: [videoId], references: [id], onDelete: Cascade)
  importBatch          YoutubeImportBatch? @relation(fields: [importBatchId], references: [id], onDelete: SetNull)
  
  @@unique([videoId, date, trafficSource, deviceType])
  @@index([videoId, date])
  @@index([importBatchId])
  @@map("youtube_video_metrics")
}

model YoutubeVideoInsight {
  id              String   @id @default(uuid())
  videoId         String   @unique @map("video_id")
  
  hookScore       Float    @map("hook_score")
  retentionScore  Float    @map("retention_score")
  ctrScore        Float    @map("ctr_score")
  contentScore    Float    @map("content_score")
  growthPotential Float    @map("growth_potential")
  
  diagnosis       String   @db.Text
  
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")
  
  video           YoutubeVideo @relation(fields: [videoId], references: [id], onDelete: Cascade)
  
  @@map("youtube_video_insights")
}

model YoutubeImportBatch {
  id              String   @id @default(uuid())
  channelId       String   @map("channel_id")
  filename        String
  totalRows       Int      @map("total_rows")
  importedRows    Int      @map("imported_rows")
  skippedRows     Int      @map("skipped_rows")
  errors          Json?
  
  importedAt      DateTime @default(now()) @map("imported_at")
  importedBy      String   @map("imported_by")
  
  channel         Channel  @relation(fields: [channelId], references: [id], onDelete: Cascade)
  user            User     @relation(fields: [importedBy], references: [id], onDelete: Cascade)
  metrics         YoutubeVideoMetrics[]
  
  @@index([channelId, importedAt])
  @@map("youtube_import_batches")
}

model ChannelPersonaHistory {
  id             String   @id @default(uuid())
  channelId      String   @map("channel_id")
  personaId      String   @map("persona_id")
  activatedAt    DateTime @map("activated_at")
  deactivatedAt  DateTime? @map("deactivated_at")
  
  channel        Channel  @relation(fields: [channelId], references: [id], onDelete: Cascade)
  persona        Persona  @relation("ChannelPersonaHistory", fields: [personaId], references: [id], onDelete: Cascade)
  
  @@index([channelId, activatedAt])
  @@index([personaId])
  @@map("channel_persona_history")
}

// ═══════════════════════════════════════════════
// ASSET REUSE & CATALOGING SYSTEM
// ═══════════════════════════════════════════════

model AssetIndex {
  id          String   @id @default(cuid())
  
  // Referência ao asset original
  source_scene_id    String
  source_project_id  String
  asset_type         AssetType
  
  // Localização do asset
  url         String
  
  // Metadados para matching
  description String   @db.Text
  tags        String[] @default([])
  category    String?
  
  // Rastreamento de uso
  use_count     Int      @default(1)
  last_used_at  DateTime @default(now())
  last_used_in_channel String?
  
  // Qualidade/Duration
  duration_seconds Float?
  quality_score    Float? @default(1.0)
  metadata         Json?
  
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  
  @@index([asset_type, category])
  @@index([source_project_id])
  @@index([tags])
  @@index([last_used_at])
  @@map("asset_index")
}

enum AssetType {
  IMAGE
  AUDIO
  VIDEO
}

